package student.cc3_task3;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.sql.DriverManager;
import java.sql.ResultSet;


public class Repository {
    private final String dbURL;
  
    private Repository(String dbURL){
        this.dbURL = dbURL;
    }
    public void save(Student student) {

        String sql = "INSERT INTO tbl_student(studentID, studentName, age, sex, course, yearLevel, nstpComp, email, contact, address) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";

        try (Connection conn = DriverManager.getConnection(dbURL);
             PreparedStatement pstmt = conn.prepareStatement(sql)) {
            
            pstmt.setInt(1, student.getStudentID());
            pstmt.setString(2, student.getStudentName());
            pstmt.setInt(3, student.getAge());
            pstmt.setString(4, student.getSex());
            pstmt.setString(5, student.getCourse());
            pstmt.setInt(6, student.getYearLevel());
            pstmt.setString(7, student.getNstpComp());
            pstmt.setString(8, student.getEmail());
            pstmt.setInt(9, student.getContact());
            pstmt.setString(10, student.getAddress());

            pstmt.executeUpdate();
            System.out.println("Student saved successfully!");

        } catch (SQLException e) {
            System.err.println("Failed to save student: " + e.getMessage());
        }
    }
    public Student retrieve(int id) {
    // 1. Explicitly list all 10 columns in the SQL string
    String sql = "SELECT studentID, studentName, age, sex, course, yearLevel, nstpComp, email, contact, address " +
                 "FROM tbl_student WHERE studentID = ?";
    
    try (Connection conn = DriverManager.getConnection(dbURL);
         PreparedStatement pstmt = conn.prepareStatement(sql)) {
        
        pstmt.setInt(1, id);
        
        try (ResultSet rs = pstmt.executeQuery()) {
            if (rs.next()) {
                // 2. Create the empty Student Object
               Student student = new Student.StudentBuilder()
                .setStudentID(rs.getInt("studentID"))
                .setStudentName(rs.getString("studentName"))
                .setAge(rs.getInt("age"))
                .setSex(rs.getString("sex"))
                .setCourse(rs.getString("course"))
                .setYearLevel(rs.getInt("yearLevel"))
                .setNstpComp(rs.getString("nstpComp"))
                .setEmail(rs.getString("email"))
                .setContact(rs.getInt("contact"))
                .setAddress(rs.getString("address"))
                .build();
                // 4. Return the complete object
                return student; 
            }
        }
    } catch (SQLException e) {
        System.err.println("Database error: " + e.getMessage());
    }
    return null; 
} 
    public static class RepositoryBuilder{
        private String path;
        
        public RepositoryBuilder setDatabasePath(String path){
            this.path = "jdbc:sqlite:" + path;
            return this;
        }
        public Repository build() {
            if (path == null) throw new IllegalStateException("Database path not set!");
            return new Repository(path);
        }
    }
}
